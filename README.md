# Arrow Master 

- 활쏘기의 달인이 되어보자!

# 🏹 3D 활쏘기 게임 - iOS 소프트웨어 아키텍처

## 📋 프로젝트 개요

**게임 컨셉**: 손가락으로 화살을 당겨 발사하는 직관적인 3D 활쏘기 게임

**핵심 기능**:
- 3D 활쏘기 게임플레이
- 소셜 로그인 (Apple, Facebook, Google)
- 크로스 디바이스 데이터 동기화
- 인앱 결제를 통한 특수 화살 구매

---

## 🏗️ 아키텍처 레이어

### 1️⃣ 프레젠테이션 레이어

#### GameViewController
- **역할**: 메인 게임 화면 관리
- **상세**: SceneKit 뷰 설정, 터치 이벤트 처리, UI 오버레이 관리

#### MenuViewController
- **역할**: 메뉴 및 설정 화면
- **상세**: 게임 시작, 레벨 선택, 설정, 리더보드 표시

#### LoginViewController
- **역할**: 로그인/회원가입 화면
- **상세**: 소셜 로그인 버튼, 게스트 모드, 계정 연동 UI

#### ShopViewController
- **역할**: 상점 화면
- **상세**: 특수 화살 패키지 표시, 구매 버튼, 보유 수량, 프로모션 배너

#### HUDView
- **역할**: 게임 내 UI 표시
- **상세**: 점수, 남은 화살, 바람 방향, 조준선, 화살 선택 버튼

---

### 2️⃣ 게임 로직 레이어

#### GameManager
- **역할**: 게임 상태 총괄 관리
- **상세**: 게임 시작/종료, 점수 계산, 레벨 진행, 게임 루프 제어

#### InputManager
- **역할**: 터치 입력 처리
- **상세**: 화살 당기기 제스처 인식, 발사 각도/파워 계산, 터치 좌표 변환

#### PhysicsManager
- **역할**: 물리 시뮬레이션
- **상세**: 화살 궤적 계산, 충돌 감지, 중력/바람 효과 적용

#### TargetManager
- **역할**: 타겟 관리
- **상세**: 타겟 생성/배치, 명중 판정, 점수 부여, 타겟 애니메이션

#### ArrowManager
- **역할**: 화살 종류 관리
- **상세**: 일반/특수 화살 전환, 화살 효과 적용, 소지 수량 관리

---

### 3️⃣ 그래픽 렌더링 레이어

#### SceneKit Scene
- **역할**: 3D 씬 구성
- **상세**: 카메라, 조명, 환경, 3D 오브젝트 배치

#### ModelManager
- **역할**: 3D 모델 관리
- **상세**: 활, 화살, 타겟, 배경 모델 로드 및 캐싱

#### AnimationController
- **역할**: 애니메이션 제어
- **상세**: 활 당기기, 화살 발사, 타겟 반응 애니메이션

#### ParticleSystem
- **역할**: 파티클 효과
- **상세**: 화살 궤적, 명중 효과, 환경 효과

#### SpecialEffectsManager
- **역할**: 특수 화살 효과
- **상세**: 불 이펙트, 얼음 이펙트, 폭발 효과, 트리플샷 궤적

---

### 4️⃣ 데이터 레이어

#### GameDataManager
- **역할**: 게임 데이터 관리
- **상세**: 레벨 정보, 타겟 배치 데이터, 난이도 설정

#### UserDataManager
- **역할**: 사용자 데이터 저장
- **상세**: 점수 기록, 진행 상황, 설정 저장 (UserDefaults/Core Data)

#### AudioManager
- **역할**: 오디오 관리
- **상세**: 효과음, 배경음악 재생 (AVAudioEngine)

#### InventoryManager
- **역할**: 인벤토리 관리
- **상세**: 보유 화살 수량, 아이템 소비/충전, 구매 내역 추적

---

### 5️⃣ 인증 및 백엔드 레이어

#### AuthenticationManager
- **역할**: 인증 총괄 관리
- **상세**: 로그인/로그아웃, 세션 관리, 토큰 갱신, 게스트→정회원 전환

#### SocialLoginService
- **역할**: 소셜 로그인 처리
- **상세**: Apple Sign In, Facebook Login, Google Sign In SDK 연동

#### BackendAPIClient
- **역할**: 백엔드 API 통신
- **상세**: 사용자 데이터 동기화, 점수 업로드, 리더보드 조회 (URLSession/Alamofire)

#### SyncManager
- **역할**: 데이터 동기화
- **상세**: 로컬↔서버 데이터 병합, 충돌 해결, 오프라인 큐 관리

#### IAPManager
- **역할**: 인앱 결제 관리
- **상세**: StoreKit 2 연동, 상품 정보 로드, 구매/복원 처리, 영수증 검증

#### ShopManager
- **역할**: 상점 비즈니스 로직
- **상세**: 화살 패키지 관리, 가격 정책, 프로모션, 구매 후 인벤토리 갱신

---

## 🛠️ 기술 스택

| 카테고리 | 기술 | 선택 이유 |
|---------|------|----------|
| **3D 엔진** | SceneKit | iOS 네이티브 3D 프레임워크 |
| **물리 엔진** | SceneKit Physics | 내장 물리 시뮬레이션 |
| **언어** | Swift | iOS 개발 표준 언어 |
| **아키텍처** | MVC + Manager Pattern | 명확한 책임 분리 |
| **UI** | UIKit + SwiftUI | 메뉴는 SwiftUI, 게임은 UIKit |
| **인증** | Sign in with Apple | Apple 필수 요구사항, 보안 |
| **소셜 로그인** | Facebook SDK + Google SDK | 다양한 로그인 옵션 제공 |
| **백엔드** | Firebase / Custom API | 인증, 실시간 DB, 클라우드 저장소 |
| **네트워킹** | URLSession / Alamofire | RESTful API 통신 |
| **인앱 결제** | StoreKit 2 | iOS 네이티브 결제 시스템 |
| **영수증 검증** | 서버 사이드 검증 | 해킹 방지, 구매 무결성 보장 |
| **저장소** | Core Data + Keychain | 로컬 데이터 및 토큰 보안 저장 |
| **오디오** | AVFoundation | 효과음 및 배경음악 |

---

## ✨ 핵심 구현 포인트

### 1. 터치 제스처
UIPanGestureRecognizer로 화살 당기기 감지, 당긴 거리로 발사 파워 계산

### 2. 물리 시뮬레이션
SceneKit의 physicsBody를 이용한 화살 궤적, 중력과 바람 효과 적용

### 3. 충돌 감지
SCNPhysicsContactDelegate로 화살과 타겟 충돌 감지, 명중 위치에 따른 점수 부여

### 4. 카메라 워크
화살 발사 시 카메라 추적, 슬로우 모션 효과로 몰입감 증대

### 5. 소셜 로그인
AuthenticationServices(Apple), FacebookLogin SDK, GoogleSignIn SDK를 통한 OAuth 인증

### 6. 데이터 동기화
로그인 시 서버에서 최신 데이터 다운로드, 게임 종료 시 자동 업로드, 충돌 시 최고 기록 우선

### 7. 특수 화살 시스템
각 화살마다 고유한 물리 특성과 파티클 효과, 타겟 명중 시 특수 효과 발동

### 8. 인앱 결제
StoreKit 2로 구매 처리, 서버에서 영수증 검증, 구매 후 즉시 인벤토리 반영 및 기기 간 동기화

---

## 🏹 특수 화살 종류

### 🔥 불화살
- **효과**: 명중 시 범위 화염 피해, 주변 타겟도 점수 획득
- **비주얼**: 파티클 화염 이펙트, 타겟에 번 애니메이션

### ❄️ 얼음화살
- **효과**: 타겟을 얼려 시간 보너스, 움직이는 타겟을 정지
- **비주얼**: 얼음 결정 파티클, 타겟 프리즈 애니메이션

### ⚡ 번개화살
- **효과**: 여러 타겟에 연쇄 공격, 전기가 퍼지며 다중 점수
- **비주얼**: 번개 이펙트, 타겟 간 전기 연결선

### 💥 폭발화살
- **효과**: 명중 후 폭발, 넓은 범위 피해로 다수 타겟 처리
- **비주얼**: 폭발 파티클, 충격파 애니메이션

### 🎯 트리플샷
- **효과**: 한 번에 3개 화살 발사, 넓은 영역 커버
- **비주얼**: 3개 궤적 동시 표시, 부채꼴 발사

### 🌟 유도화살
- **효과**: 타겟을 자동 추적하여 명중률 대폭 상승
- **비주얼**: 궤적 자동 수정, 추적 파티클 효과

---

## 🔐 인증 플로우

### 게스트 모드
로그인 없이 바로 플레이 가능, 기기에만 데이터 저장, 나중에 계정 연동 가능

### 소셜 로그인
Apple/Facebook/Google 계정으로 로그인 → 서버에서 사용자 프로필 조회/생성 → 로컬 데이터와 병합

### 계정 연동
게스트 데이터를 소셜 계정에 연결 → 기존 기록 유지하며 다른 기기에서도 접속 가능

### 자동 로그인
Keychain에 토큰 저장 → 앱 재실행 시 자동 인증 → 백그라운드에서 데이터 동기화

---

## 💳 인앱 결제 플로우

### 1단계: 상점 접근
ShopViewController에서 상품 목록 표시 → StoreKit으로 앱스토어 가격 정보 로드

### 2단계: 구매 요청
사용자가 상품 선택 → IAPManager가 StoreKit purchase() 호출 → Face ID/Touch ID 인증

### 3단계: 영수증 검증
구매 성공 시 영수증을 서버로 전송 → 서버가 Apple 서버에 검증 요청 → 유효성 확인

### 4단계: 아이템 지급
서버에서 승인 → InventoryManager가 화살 수량 증가 → Core Data 저장 → UI 즉시 갱신

### 5단계: 동기화
구매 내역이 모든 기기에 자동 동기화 → 다른 기기에서도 특수 화살 사용 가능

### ⚠️ 보안 주의사항
**모든 구매는 반드시 서버 검증 필수!** 클라이언트만 믿으면 해킹 위험

---

## 📊 데이터 흐름도

```
사용자 입력
    ↓
InputManager → GameManager
    ↓
PhysicsManager (물리 계산)
    ↓
SceneKit (렌더링)
    ↓
TargetManager (충돌 감지)
    ↓
GameManager (점수 계산)
    ↓
UserDataManager (로컬 저장)
    ↓
SyncManager → BackendAPIClient (서버 동기화)
```

---

## 🎮 게임플레이 시나리오

### 일반 플레이
1. 사용자가 화면을 터치하여 화살 당기기
2. InputManager가 제스처 인식 및 파워 계산
3. 손가락을 떼면 PhysicsManager가 궤적 계산
4. SceneKit이 화살 비행 애니메이션 렌더링
5. 타겟 명중 시 TargetManager가 점수 계산
6. HUDView가 점수 업데이트

### 특수 화살 사용
1. HUD에서 특수 화살 선택 버튼 터치
2. InventoryManager가 보유 수량 확인
3. ArrowManager가 화살 종류 전환
4. 발사 시 SpecialEffectsManager가 특수 효과 적용
5. 명중 시 특수 효과 발동 (화염, 얼음, 폭발 등)
6. 소모된 화살 수량 자동 차감

### 화살 구매
1. 메뉴에서 상점 접근
2. ShopViewController가 상품 목록 표시
3. 사용자가 패키지 선택 및 구매
4. IAPManager가 StoreKit 결제 처리
5. 영수증을 서버로 전송하여 검증
6. 검증 완료 시 InventoryManager가 화살 지급
7. 모든 기기에 자동 동기화

---

## 🚀 향후 확장 가능성

- **멀티플레이어**: 실시간 대결 모드
- **시즌 패스**: 정기 콘텐츠 업데이트
- **길드 시스템**: 팀 플레이 및 협동
- **월드 리더보드**: 글로벌 랭킹 시스템
- **커스텀 스킨**: 활과 화살 외형 변경
- **스토리 모드**: 캠페인 및 보스전
- **데일리 미션**: 일일 과제 및 보상

---

## 📝 개발 우선순위

### Phase 1 - MVP (최소 기능 제품)
- 기본 3D 활쏘기 게임플레이
- 터치 제스처 입력
- 타겟 시스템
- 점수 계산

### Phase 2 - 소셜 기능
- Apple Sign In 연동
- 데이터 동기화
- 리더보드

### Phase 3 - 수익화
- 인앱 결제 시스템
- 특수 화살 6종
- 상점 UI

### Phase 4 - 폴리싱
- 소셜 로그인 추가 (Facebook, Google)
- 고급 그래픽 효과
- 사운드 및 음악
- 성능 최적화

---

## 📚 참고 문서

- [SceneKit 공식 문서](https://developer.apple.com/documentation/scenekit)
- [StoreKit 2 가이드](https://developer.apple.com/documentation/storekit)
- [Sign in with Apple](https://developer.apple.com/sign-in-with-apple/)
- [Core Data 프로그래밍 가이드](https://developer.apple.com/documentation/coredata)

---

**문서 버전**: 1.0  
**작성일**: 2025년 10월 1일  
**최종 수정일**: 2025년 10월 1일
